<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>仪表盘</title>
  <style>
    body { font-family: Arial, sans-serif; display: flex; align-items: center; justify-content: center; height: 100vh; background: #f0f2f5; }
    .container { text-align: center; background: #fff; padding: 40px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,.1); }
    h1 { color: #333; }
    p { color: #555; font-size: 1.2em; }
    a { color: #64a9d9; text-decoration: none; }
  </style>
</head>
<body>

<div class="container">
  <h1 id="welcome-message">正在加载用户信息...</h1>
  <p>这是一个受保护的页面。</p>
  <a href="login.html" onclick="logout()">退出登录</a>
</div>

<script>
  const API = 'http://localhost:5000';

  // 页面加载时，自动获取用户信息
  window.onload = async () => {
    const token = localStorage.getItem('token');

    // 如果没有token，说明未登录，跳转回登录页
    if (!token) {
      location.href = 'login.html';
      return;
    }

    try {
      // 请求受保护的 /api/profile 接口
      const response = await fetch(API + '/api/profile', {
        method: 'GET',
        headers: {
          // 在请求头中携带 JWT
          'Authorization': `Bearer ${token}`
        }
      });

      if (!response.ok) {
        // 如果 token 过期或无效，服务器会返回401
        throw await response.json();
      }

      const data = await response.json();
      document.getElementById('welcome-message').textContent = data.message;

    } catch (err) {
      console.error('获取用户信息失败:', err);
      alert(err.msg || '会话已过期，请重新登录。');
      // 清除无效的token并跳转
      localStorage.removeItem('token');
      location.href = 'login.html';
    }
  };

  function logout() {
    // 退出登录时，清除token
    localStorage.removeItem('token');
  }
</script>

</body>
</html>